<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Infinitely Weird DevOps</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="nav.css" />
  <style>
    :root{--glass:rgba(255,255,255,0.06);--glass-hover:rgba(255,255,255,0.1);--border:rgba(255,255,255,0.12);--text:#f0f0f0;--muted:rgba(255,255,255,0.5);--accent:#34d399;--accent-2:rgba(52,211,153,0.15);--danger:#f87171;--warning:#fbbf24;--info:#60a5fa;--purple:#a78bfa}
    *{box-sizing:border-box}body{font-family:'Inter',sans-serif;margin:0;padding:0;min-height:100vh;background:linear-gradient(135deg,#0f172a 0%,#1e1b4b 50%,#0f172a 100%);color:var(--text)}.gradient-bg{position:fixed;inset:0;z-index:-1;background:linear-gradient(135deg,#0f172a 0%,#1e1b4b 50%,#0f172a 100%)}
    main{max-width:1400px;margin:0 auto;padding:1rem 1.5rem 3rem}
    .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem}.page-header h1{font-family:'Space Grotesk',sans-serif;font-size:2rem;margin:0}.page-header h1 span{color:var(--accent)}.eyebrow{font-size:.75rem;text-transform:uppercase;letter-spacing:.15em;color:var(--muted);margin-bottom:.2rem}
    .btn{padding:.5rem 1.2rem;border-radius:10px;border:none;font-family:inherit;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:.4rem}.btn-primary{background:var(--accent);color:#0f172a}.btn-primary:hover{background:#6ee7b7}.btn-ghost{background:var(--glass);color:var(--text);border:1px solid var(--border)}.btn-ghost:hover{background:var(--glass-hover)}.btn-danger{background:rgba(248,113,113,.15);color:var(--danger);border:1px solid rgba(248,113,113,.3)}.btn-danger:hover{background:rgba(248,113,113,.25)}.btn-sm{padding:.3rem .7rem;font-size:.75rem}.btn-approve{background:rgba(52,211,153,.15);color:var(--accent);border:1px solid rgba(52,211,153,.3)}.btn-approve:hover{background:rgba(52,211,153,.25)}
    .glass-card{background:var(--glass);border:1px solid var(--border);border-radius:16px;backdrop-filter:blur(14px);padding:1.2rem;transition:all .25s}

    /* Tabs */
    .tabs{display:flex;gap:.3rem;margin-bottom:1.5rem;background:var(--glass);padding:.3rem;border-radius:12px;border:1px solid var(--border);overflow-x:auto}
    .tab{padding:.5rem 1.2rem;border-radius:10px;border:none;background:transparent;color:var(--muted);font-family:inherit;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
    .tab.active{background:var(--accent-2);color:var(--accent)}
    .tab:hover:not(.active){color:var(--text)}
    .tab-content{display:none}.tab-content.active{display:block}

    /* Pending approvals */
    .pending-section{margin-bottom:2rem}.pending-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:.8rem}
    .pending-card{display:flex;align-items:center;gap:1rem;padding:1rem}
    .pending-avatar{width:42px;height:42px;border-radius:50%;background:rgba(251,191,36,.15);display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:600;flex-shrink:0}
    .pending-info{flex:1;min-width:0}.pending-info .name{font-weight:600;font-size:.9rem}.pending-info .email{font-size:.75rem;color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .pending-actions{display:flex;gap:.4rem}

    /* User table */
    .user-table{width:100%;border-collapse:collapse;font-size:.82rem}
    .user-table th{text-align:left;color:var(--muted);font-weight:500;padding:.6rem .8rem;border-bottom:1px solid var(--border);font-size:.75rem;text-transform:uppercase;letter-spacing:.08em}
    .user-table td{padding:.6rem .8rem;border-bottom:1px solid rgba(255,255,255,.04);vertical-align:middle}
    .user-table tr:hover td{background:rgba(255,255,255,.03)}
    .user-avatar{width:30px;height:30px;border-radius:50%;background:var(--glass-hover);display:inline-flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:600;margin-right:.5rem;vertical-align:middle}
    .badge{display:inline-block;padding:.15rem .55rem;border-radius:6px;font-size:.7rem;font-weight:600;text-transform:uppercase}.badge-approved{background:rgba(52,211,153,.2);color:#6ee7b7}.badge-pending{background:rgba(251,191,36,.2);color:#fcd34d}
    .role-chip{display:inline-block;padding:.1rem .4rem;border-radius:5px;font-size:.68rem;background:rgba(167,139,250,.15);color:#c4b5fd;margin-right:.2rem}
    .action-btns{display:flex;gap:.3rem;flex-wrap:wrap}

    /* Roles/Groups/Perms lists */
    .entity-list{display:flex;flex-direction:column;gap:.5rem}
    .entity-item{display:flex;align-items:center;justify-content:space-between;padding:.8rem 1rem;flex-wrap:wrap;gap:.5rem}
    .entity-name{font-weight:600;font-size:.9rem}
    .entity-meta{font-size:.78rem;color:var(--muted)}
    .add-row{display:flex;gap:.5rem;margin-bottom:1rem}
    .add-row input{flex:1;background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--text);padding:.45rem .8rem;border-radius:8px;font-family:inherit;font-size:.82rem;outline:none}

    /* Modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:300;opacity:0;pointer-events:none;transition:opacity .25s}.modal-overlay.open{opacity:1;pointer-events:all}.modal{background:rgba(20,20,35,.97);border:1px solid var(--border);border-radius:20px;padding:2rem;max-width:600px;width:90%;max-height:85vh;overflow-y:auto}.modal h2{font-family:'Space Grotesk',sans-serif;margin:0 0 1.2rem;font-size:1.3rem}.modal label{display:block;font-size:.8rem;color:var(--muted);margin-bottom:.3rem;margin-top:.8rem}.modal input,.modal select{width:100%;background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--text);padding:.5rem .8rem;border-radius:8px;font-family:inherit;font-size:.85rem;outline:none}.modal select option{background:#1e1b4b}.modal-actions{display:flex;gap:.6rem;justify-content:flex-end;margin-top:1.5rem}

    .section-title{font-family:'Space Grotesk',sans-serif;font-size:1.1rem;margin:1.5rem 0 .8rem;display:flex;align-items:center;gap:.5rem}
    .empty-state{text-align:center;padding:2rem;color:var(--muted)}.empty-state .empty-icon{font-size:2.5rem;margin-bottom:.5rem}
    @media(max-width:768px){.user-table{font-size:.75rem}.pending-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="gradient-bg"></div>
  <script src="nav.js"></script>
  <main>
    <div class="page-header">
      <div>
        <p class="eyebrow">Administration</p>
        <h1>‚öôÔ∏è <span>Admin</span> Control Room</h1>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('users')">üë• Users</button>
      <button class="tab" onclick="switchTab('roles')">üé≠ Roles</button>
      <button class="tab" onclick="switchTab('groups')">üìÅ Groups</button>
      <button class="tab" onclick="switchTab('permissions')">üîê Permissions</button>
    </div>

    <!-- USERS TAB -->
    <div class="tab-content active" id="tab-users">
      <div class="pending-section" id="pendingSection"></div>
      <div class="glass-card" style="overflow-x:auto">
        <table class="user-table">
          <thead><tr><th>User</th><th>Email</th><th>Status</th><th>Roles</th><th>Groups</th><th>Joined</th><th>Actions</th></tr></thead>
          <tbody id="userTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- ROLES TAB -->
    <div class="tab-content" id="tab-roles">
      <div class="add-row"><input type="text" id="newRoleName" placeholder="New role name..." /><button class="btn btn-primary btn-sm" onclick="createRole()">+ Add Role</button></div>
      <div class="entity-list" id="roleList"></div>
    </div>

    <!-- GROUPS TAB -->
    <div class="tab-content" id="tab-groups">
      <div class="add-row"><input type="text" id="newGroupName" placeholder="New group name..." /><button class="btn btn-primary btn-sm" onclick="createGroup()">+ Add Group</button></div>
      <div class="entity-list" id="groupList"></div>
    </div>

    <!-- PERMISSIONS TAB -->
    <div class="tab-content" id="tab-permissions">
      <p style="color:var(--muted);font-size:.85rem;margin-bottom:1rem">Permissions are assigned to roles. Select a role to manage its permissions.</p>
      <div style="display:flex;gap:.5rem;margin-bottom:1rem;flex-wrap:wrap">
        <select id="permRoleSelect" style="background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--text);padding:.45rem .8rem;border-radius:8px;font-family:inherit;font-size:.82rem;outline:none"><option value="">Select a role...</option></select>
      </div>
      <div id="permList"></div>
    </div>
  </main>

  <!-- Edit User Modal -->
  <div class="modal-overlay" id="editUserModal">
    <div class="modal">
      <h2>‚úèÔ∏è Edit User</h2>
      <input type="hidden" id="editUserId" />
      <label>Username</label><input type="text" id="editUsername" />
      <label>Email</label><input type="text" id="editEmail" />
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeEditModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveUser()">üíæ Save</button>
      </div>
    </div>
  </div>

  <!-- Reset Password Modal -->
  <div class="modal-overlay" id="resetPwModal">
    <div class="modal">
      <h2>üîë Reset Password</h2>
      <input type="hidden" id="resetPwUserId" />
      <label>New Password (min 6 characters)</label><input type="password" id="resetPwInput" placeholder="Enter new password..." />
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeResetPwModal()">Cancel</button>
        <button class="btn btn-primary" onclick="resetPassword()">üîë Reset</button>
      </div>
    </div>
  </div>

  <!-- Role Permissions Modal -->
  <div class="modal-overlay" id="rolePermModal">
    <div class="modal">
      <h2 id="rolePermTitle">üé≠ Role Permissions</h2>
      <input type="hidden" id="rolePermRoleId" />
      <div id="rolePermBody"></div>
      <div class="modal-actions"><button class="btn btn-ghost" onclick="closeRolePermModal()">Close</button></div>
    </div>
  </div>

  <script>
    const TOKEN = localStorage.getItem('token');
    const H = () => ({ 'Authorization': `Bearer ${TOKEN}`, 'Content-Type': 'application/json' });
    let allUsers = [], allRoles = [], allGroups = [], allPerms = [];

    async function init() {
      await Promise.all([loadUsers(), loadPending(), loadRoles(), loadGroups(), loadPermissions()]);
    }

    // ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchTab(name) {
      document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', t.textContent.toLowerCase().includes(name)));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('active', c.id === 'tab-' + name));
    }

    // ‚îÄ‚îÄ‚îÄ USERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadUsers() {
      try {
        const r = await fetch('/api/admin/users', { headers: H() });
        allUsers = await r.json();
        renderUsers();
      } catch(e) { console.error(e); }
    }

    function renderUsers() {
      document.getElementById('userTableBody').innerHTML = allUsers.map(u => `
        <tr>
          <td><span class="user-avatar">${(u.Username||'?').substring(0,2).toUpperCase()}</span>${esc(u.Username)}</td>
          <td>${esc(u.Email||'‚Äî')}</td>
          <td><span class="badge ${u.IsApproved?'badge-approved':'badge-pending'}">${u.IsApproved?'Active':'Pending'}</span></td>
          <td>${(u.Roles||'').split(', ').filter(Boolean).map(r=>'<span class="role-chip">'+esc(r)+'</span>').join('')||'<span style="color:var(--muted)">‚Äî</span>'}</td>
          <td style="font-size:.78rem;color:var(--muted)">${esc(u.Groups||'‚Äî')}</td>
          <td style="font-size:.75rem;color:var(--muted)">${fmtDate(u.CreatedAt)}</td>
          <td><div class="action-btns">
            <button class="btn btn-sm btn-ghost" onclick="openEditModal(${u.UserID},'${escAttr(u.Username)}','${escAttr(u.Email||'')}')">‚úèÔ∏è</button>
            <button class="btn btn-sm btn-ghost" onclick="openResetPwModal(${u.UserID})">üîë</button>
            <button class="btn btn-sm ${u.IsApproved?'btn-danger':'btn-approve'}" onclick="toggleApproval(${u.UserID})">${u.IsApproved?'Disable':'Enable'}</button>
          </div></td>
        </tr>
      `).join('');
    }

    async function loadPending() {
      try {
        const r = await fetch('/api/admin/users/pending', { headers: H() });
        const pending = await r.json();
        const sec = document.getElementById('pendingSection');
        if (pending.length === 0) { sec.innerHTML = ''; return; }
        sec.innerHTML = `
          <h2 class="section-title">üîî Pending Approvals <span class="badge badge-pending" style="font-size:.8rem">${pending.length}</span></h2>
          <div class="pending-grid">${pending.map(u => `
            <div class="glass-card pending-card">
              <div class="pending-avatar">üßë</div>
              <div class="pending-info"><div class="name">${esc(u.Username)}</div><div class="email">${esc(u.Email||'No email')}</div><div style="font-size:.7rem;color:var(--muted);margin-top:.15rem">Applied ${fmtDate(u.CreatedAt)}</div></div>
              <div class="pending-actions">
                <button class="btn btn-sm btn-approve" onclick="approveUser(${u.UserID})">‚úÖ</button>
                <button class="btn btn-sm btn-danger" onclick="denyUser(${u.UserID})">‚ùå</button>
              </div>
            </div>
          `).join('')}</div>`;
      } catch(e) { console.error(e); }
    }

    async function approveUser(id) { await fetch(`/api/admin/users/${id}/approve`, { method:'POST', headers:H() }); loadUsers(); loadPending(); }
    async function denyUser(id) { if(!confirm('Deny and delete this user?')) return; await fetch(`/api/admin/users/${id}/deny`, { method:'POST', headers:H() }); loadUsers(); loadPending(); }
    async function toggleApproval(id) { await fetch(`/api/admin/users/${id}/toggle-approval`, { method:'POST', headers:H() }); loadUsers(); }

    function openEditModal(id, username, email) { document.getElementById('editUserId').value=id; document.getElementById('editUsername').value=username; document.getElementById('editEmail').value=email; document.getElementById('editUserModal').classList.add('open'); }
    function closeEditModal() { document.getElementById('editUserModal').classList.remove('open'); }
    async function saveUser() {
      const id = document.getElementById('editUserId').value;
      await fetch(`/api/admin/users/${id}`, { method:'PUT', headers:H(), body:JSON.stringify({ username:document.getElementById('editUsername').value, email:document.getElementById('editEmail').value }) });
      closeEditModal(); loadUsers();
    }

    function openResetPwModal(id) { document.getElementById('resetPwUserId').value=id; document.getElementById('resetPwInput').value=''; document.getElementById('resetPwModal').classList.add('open'); }
    function closeResetPwModal() { document.getElementById('resetPwModal').classList.remove('open'); }
    async function resetPassword() {
      const id = document.getElementById('resetPwUserId').value;
      const pw = document.getElementById('resetPwInput').value;
      if(pw.length<6) return alert('Password must be at least 6 characters');
      const r = await fetch(`/api/admin/users/${id}/reset-password`, { method:'POST', headers:H(), body:JSON.stringify({ newPassword:pw }) });
      const data = await r.json();
      alert(data.message);
      closeResetPwModal();
    }

    // ‚îÄ‚îÄ‚îÄ ROLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadRoles() {
      try {
        const r = await fetch('/api/admin/roles', { headers: H() });
        allRoles = await r.json();
        renderRoles();
        // Update perm role select
        const sel = document.getElementById('permRoleSelect');
        sel.innerHTML = '<option value="">Select a role...</option>' + allRoles.map(r=>`<option value="${r.RoleID}">${esc(r.RoleName)}</option>`).join('');
      } catch(e) { console.error(e); }
    }

    function renderRoles() {
      document.getElementById('roleList').innerHTML = allRoles.length === 0
        ? '<div class="empty-state"><div class="empty-icon">üé≠</div><p>No roles yet. That\'s weird... create one!</p></div>'
        : allRoles.map(r => `
          <div class="glass-card entity-item">
            <div><div class="entity-name">üé≠ ${esc(r.RoleName)}</div></div>
            <div class="action-btns">
              <button class="btn btn-sm btn-ghost" onclick="manageRolePerms(${r.RoleID},'${escAttr(r.RoleName)}')">üîê Perms</button>
              <button class="btn btn-sm btn-danger" onclick="deleteRole(${r.RoleID})">üóë</button>
            </div>
          </div>
        `).join('');
    }

    async function createRole() {
      const name = document.getElementById('newRoleName').value.trim();
      if(!name) return;
      await fetch('/api/admin/roles', { method:'POST', headers:H(), body:JSON.stringify({roleName:name}) });
      document.getElementById('newRoleName').value = '';
      loadRoles();
    }

    async function deleteRole(id) { if(!confirm('Delete this role?')) return; await fetch(`/api/admin/roles/${id}`, {method:'DELETE',headers:H()}); loadRoles(); }

    // ‚îÄ‚îÄ‚îÄ GROUPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadGroups() {
      try {
        const r = await fetch('/api/admin/groups', { headers: H() });
        allGroups = await r.json();
        renderGroups();
      } catch(e) { console.error(e); }
    }

    function renderGroups() {
      document.getElementById('groupList').innerHTML = allGroups.length === 0
        ? '<div class="empty-state"><div class="empty-icon">üìÅ</div><p>No groups. The void is empty but full of potential! ‚ú®</p></div>'
        : allGroups.map(g => `
          <div class="glass-card entity-item">
            <div><div class="entity-name">üìÅ ${esc(g.GroupName)}</div><div class="entity-meta">${g.Roles ? 'Roles: ' + g.Roles.split(', ').map(r=>'<span class="role-chip">'+esc(r)+'</span>').join('') : 'No roles assigned'}</div></div>
            <button class="btn btn-sm btn-danger" onclick="deleteGroup(${g.GroupID})">üóë</button>
          </div>
        `).join('');
    }

    async function createGroup() {
      const name = document.getElementById('newGroupName').value.trim();
      if(!name) return;
      await fetch('/api/admin/groups', { method:'POST', headers:H(), body:JSON.stringify({groupName:name}) });
      document.getElementById('newGroupName').value = '';
      loadGroups();
    }

    async function deleteGroup(id) { if(!confirm('Delete this group?')) return; await fetch(`/api/admin/groups/${id}`, {method:'DELETE',headers:H()}); loadGroups(); }

    // ‚îÄ‚îÄ‚îÄ PERMISSIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadPermissions() {
      try {
        const r = await fetch('/api/admin/permissions', { headers: H() });
        allPerms = await r.json();
      } catch(e) { console.error(e); }
    }

    document.getElementById('permRoleSelect').addEventListener('change', async function() {
      const roleId = this.value;
      if(!roleId) { document.getElementById('permList').innerHTML = ''; return; }
      try {
        const r = await fetch(`/api/admin/roles/${roleId}/permissions`, { headers:H() });
        const rolePerms = await r.json();
        const rolePermIds = new Set(rolePerms.map(p=>p.PermissionID));
        document.getElementById('permList').innerHTML = `
          <div class="entity-list">${allPerms.map(p => `
            <div class="glass-card entity-item">
              <div><div class="entity-name" style="font-size:.85rem">${esc(p.PermissionName)}</div><div class="entity-meta">${esc(p.Description||'')}</div></div>
              <button class="btn btn-sm ${rolePermIds.has(p.PermissionID)?'btn-danger':'btn-approve'}" onclick="${rolePermIds.has(p.PermissionID)?`revokePermission(${roleId},${p.PermissionID})`:`assignPermission(${roleId},${p.PermissionID})`}">${rolePermIds.has(p.PermissionID)?'Revoke':'Grant'}</button>
            </div>
          `).join('')}</div>`;
      } catch(e) { console.error(e); }
    });

    async function assignPermission(roleId, permId) { await fetch(`/api/admin/roles/${roleId}/permissions/${permId}`, {method:'POST',headers:H()}); document.getElementById('permRoleSelect').dispatchEvent(new Event('change')); }
    async function revokePermission(roleId, permId) { await fetch(`/api/admin/roles/${roleId}/permissions/${permId}`, {method:'DELETE',headers:H()}); document.getElementById('permRoleSelect').dispatchEvent(new Event('change')); }

    async function manageRolePerms(roleId, roleName) {
      document.getElementById('rolePermTitle').textContent = 'üé≠ ' + roleName + ' Permissions';
      document.getElementById('rolePermRoleId').value = roleId;
      try {
        const r = await fetch(`/api/admin/roles/${roleId}/permissions`, { headers:H() });
        const rolePerms = await r.json();
        const rolePermIds = new Set(rolePerms.map(p=>p.PermissionID));
        document.getElementById('rolePermBody').innerHTML = allPerms.length === 0
          ? '<p style="color:var(--muted)">No permissions defined yet.</p>'
          : allPerms.map(p => `
            <div style="display:flex;align-items:center;justify-content:space-between;padding:.5rem 0;border-bottom:1px solid rgba(255,255,255,.04)">
              <div><div style="font-weight:600;font-size:.85rem">${esc(p.PermissionName)}</div><div style="font-size:.75rem;color:var(--muted)">${esc(p.Description||'')}</div></div>
              <button class="btn btn-sm ${rolePermIds.has(p.PermissionID)?'btn-danger':'btn-approve'}" onclick="toggleRolePerm(${roleId},${p.PermissionID},${rolePermIds.has(p.PermissionID)})">${rolePermIds.has(p.PermissionID)?'Revoke':'Grant'}</button>
            </div>
          `).join('');
        document.getElementById('rolePermModal').classList.add('open');
      } catch(e) { console.error(e); }
    }

    async function toggleRolePerm(roleId, permId, hasIt) {
      if(hasIt) await fetch(`/api/admin/roles/${roleId}/permissions/${permId}`, {method:'DELETE',headers:H()});
      else await fetch(`/api/admin/roles/${roleId}/permissions/${permId}`, {method:'POST',headers:H()});
      const roleName = allRoles.find(r=>r.RoleID===roleId)?.RoleName||'';
      manageRolePerms(roleId, roleName);
    }
    function closeRolePermModal() { document.getElementById('rolePermModal').classList.remove('open'); }

    function esc(s) { if(!s) return ''; const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }
    function escAttr(s) { return (s||'').replace(/'/g,"\\'").replace(/"/g,'&quot;'); }
    function fmtDate(d) { if(!d) return '‚Äî'; return new Date(d).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}); }

    init();
  </script>
</body>
</html>
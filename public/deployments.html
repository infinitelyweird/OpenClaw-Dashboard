<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deployments &amp; SOPs - Infinitely Weird DevOps</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="nav.css" />
  <link rel="stylesheet" href="loader.css" />
  <style>
    :root{--glass:rgba(255,255,255,0.06);--glass-hover:rgba(255,255,255,0.1);--border:rgba(255,255,255,0.12);--text:#f0f0f0;--muted:rgba(255,255,255,0.5);--accent:#34d399;--accent-2:rgba(52,211,153,0.15);--danger:#f87171;--warning:#fbbf24;--info:#60a5fa;--purple:#a78bfa}
    *{box-sizing:border-box}body{font-family:'Inter',sans-serif;margin:0;padding:0;min-height:100vh;background:linear-gradient(135deg,#0f172a 0%,#1e1b4b 50%,#0f172a 100%);color:var(--text)}.gradient-bg{position:fixed;inset:0;z-index:-1;background:linear-gradient(135deg,#0f172a 0%,#1e1b4b 50%,#0f172a 100%)}
    main{max-width:1400px;margin:0 auto;padding:1rem 1.5rem 3rem}
    .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem}.page-header h1{font-family:'Space Grotesk',sans-serif;font-size:2rem;margin:0}.page-header h1 span{color:var(--accent)}.eyebrow{font-size:.75rem;text-transform:uppercase;letter-spacing:.15em;color:var(--muted);margin-bottom:.2rem}
    .btn{padding:.5rem 1.2rem;border-radius:10px;border:none;font-family:inherit;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:.4rem}.btn-primary{background:var(--accent);color:#0f172a}.btn-primary:hover{background:#6ee7b7}.btn-ghost{background:var(--glass);color:var(--text);border:1px solid var(--border)}.btn-ghost:hover{background:var(--glass-hover)}
    .glass-card{background:var(--glass);border:1px solid var(--border);border-radius:16px;backdrop-filter:blur(14px);padding:1.2rem;transition:all .25s}.glass-card:hover{background:var(--glass-hover)}
    .section-title{font-family:'Space Grotesk',sans-serif;font-size:1.2rem;margin:2rem 0 1rem;display:flex;align-items:center;gap:.5rem}

    /* Pipeline */
    .pipeline{display:flex;align-items:center;gap:0;margin-bottom:2rem;flex-wrap:wrap;justify-content:center}
    .pipeline-stage{flex:1;min-width:140px;text-align:center;padding:1rem;position:relative;background:var(--glass);border:1px solid var(--border);transition:all .3s}
    .pipeline-stage:first-child{border-radius:16px 0 0 16px}.pipeline-stage:last-child{border-radius:0 16px 16px 0}
    .pipeline-stage .stage-icon{font-size:1.6rem;margin-bottom:.3rem}.pipeline-stage .stage-label{font-size:.82rem;font-weight:600}.pipeline-stage .stage-status{font-size:.7rem;color:var(--muted);margin-top:.2rem}
    .pipeline-stage.success{border-color:rgba(52,211,153,.4);background:rgba(52,211,153,.08)}.pipeline-stage.running{border-color:rgba(96,165,250,.4);background:rgba(96,165,250,.08);animation:pulse 2s infinite}.pipeline-stage.pending{opacity:.5}.pipeline-stage.failed{border-color:rgba(248,113,113,.4);background:rgba(248,113,113,.08)}
    .pipeline-arrow{font-size:1.2rem;color:var(--muted);padding:0 .3rem}
    @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(96,165,250,.3)}50%{box-shadow:0 0 20px 4px rgba(96,165,250,.15)}}

    /* Deployment history */
    .deploy-list{display:flex;flex-direction:column;gap:.6rem}
    .deploy-item{display:grid;grid-template-columns:auto 1fr auto auto auto;gap:1rem;align-items:center;padding:.8rem 1rem}
    .status-icon{font-size:1.1rem}
    .badge{display:inline-block;padding:.15rem .55rem;border-radius:6px;font-size:.72rem;font-weight:600;text-transform:uppercase}.badge-success{background:rgba(52,211,153,.2);color:#6ee7b7}.badge-failed{background:rgba(248,113,113,.2);color:#fca5a5}.badge-in-progress{background:rgba(96,165,250,.2);color:#93c5fd}.badge-rollback{background:rgba(251,191,36,.2);color:#fcd34d}
    .env-badge{padding:.15rem .5rem;border-radius:6px;font-size:.7rem;font-weight:600;background:rgba(167,139,250,.15);color:#c4b5fd}

    /* SOP Accordion */
    .sop-list{display:flex;flex-direction:column;gap:.6rem}
    .sop-item{border-radius:14px;overflow:hidden}
    .sop-header{display:flex;align-items:center;justify-content:space-between;padding:.8rem 1rem;cursor:pointer;font-weight:600;font-size:.9rem;background:var(--glass);border:1px solid var(--border);border-radius:14px;transition:all .2s}
    .sop-header:hover{background:var(--glass-hover)}
    .sop-header.open{border-radius:14px 14px 0 0;border-bottom-color:transparent}
    .sop-body{max-height:0;overflow:hidden;transition:max-height .35s ease;background:rgba(255,255,255,.03);border:1px solid var(--border);border-top:none;border-radius:0 0 14px 14px}
    .sop-body.open{max-height:800px}
    .sop-body-inner{padding:1rem}
    .checklist{list-style:none;padding:0;margin:0}.checklist li{display:flex;align-items:center;gap:.6rem;padding:.4rem 0;font-size:.85rem;border-bottom:1px solid rgba(255,255,255,.04)}.checklist li:last-child{border:none}
    .checklist input[type=checkbox]{accent-color:var(--accent);width:16px;height:16px;cursor:pointer}

    /* Modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:300;opacity:0;pointer-events:none;transition:opacity .25s}.modal-overlay.open{opacity:1;pointer-events:all}.modal{background:rgba(20,20,35,.97);border:1px solid var(--border);border-radius:20px;padding:2rem;max-width:600px;width:90%;max-height:85vh;overflow-y:auto}.modal h2{font-family:'Space Grotesk',sans-serif;margin:0 0 1.2rem;font-size:1.3rem}.modal label{display:block;font-size:.8rem;color:var(--muted);margin-bottom:.3rem;margin-top:.8rem}.modal input,.modal select,.modal textarea{width:100%;background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--text);padding:.5rem .8rem;border-radius:8px;font-family:inherit;font-size:.85rem;outline:none}.modal textarea{resize:vertical;min-height:80px}.modal select option{background:#1e1b4b}.modal-actions{display:flex;gap:.6rem;justify-content:flex-end;margin-top:1.5rem}

    .empty-state{text-align:center;padding:3rem 2rem;color:var(--muted)}.empty-state .empty-icon{font-size:3rem;margin-bottom:1rem}.empty-state h3{color:var(--text)}
    .header-actions{display:flex;gap:.6rem;flex-wrap:wrap}
    @media(max-width:768px){.pipeline{flex-direction:column}.pipeline-arrow{transform:rotate(90deg)}.deploy-item{grid-template-columns:1fr;gap:.3rem}}
  </style>
</head>
<body>
  <div class="gradient-bg"></div>
  <script src="nav.js"></script>
  <div id="page-content">
    <div class="page-header">
      <div>
        <p class="eyebrow">Deployment & Operations</p>
        <h1>üõ∏ <span>Deploy</span> & Operate</h1>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" onclick="openDeployModal()">üöÄ New Deployment</button>
        <button class="btn btn-ghost" onclick="openSopModal()">üìã New SOP</button>
      </div>
    </div>

    <!-- Pipeline Visualization -->
    <h2 class="section-title">‚ö° Current Pipeline</h2>
    <div class="pipeline" id="pipeline"></div>

    <!-- Deployment History -->
    <h2 class="section-title">üìú Deployment History</h2>
    <div class="deploy-list" id="deployList"></div>

    <!-- SOPs -->
    <h2 class="section-title">üìñ Standard Operating Procedures</h2>
    <div class="sop-list" id="sopList"></div>
  </div>

  <!-- Deploy Modal -->
  <div class="modal-overlay" id="deployModal">
    <div class="modal">
      <h2>üöÄ Launch a Deployment</h2>
      <label>Service / App</label>
      <input type="text" id="deployService" placeholder="e.g. weird-api-v2" />
      <label>Environment</label>
      <select id="deployEnv"><option>Production</option><option>Staging</option><option>Development</option></select>
      <label>Branch / Tag</label>
      <input type="text" id="deployBranch" placeholder="main" />
      <label>Notes</label>
      <textarea id="deployNotes" placeholder="Any weird notes..."></textarea>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeDeployModal()">Cancel</button>
        <button class="btn btn-primary" onclick="createDeployment()">üöÄ Deploy!</button>
      </div>
    </div>
  </div>

  <!-- SOP Modal -->
  <div class="modal-overlay" id="sopModal">
    <div class="modal">
      <h2>üìã Create SOP</h2>
      <label>Title</label>
      <input type="text" id="sopTitle" placeholder="e.g. Database Failover Procedure" />
      <label>Steps (one per line)</label>
      <textarea id="sopSteps" placeholder="Step 1: Do the weird thing&#10;Step 2: Verify weirdness&#10;Step 3: Celebrate üéâ"></textarea>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeSopModal()">Cancel</button>
        <button class="btn btn-primary" onclick="createSop()">üíæ Save SOP</button>
      </div>
    </div>
  </div>

  <script src="loader.js"></script>
  <script>
    const TOKEN = localStorage.getItem('token');

    // TODO: Connect to deployment API when route is built
    // Mock data
    const pipelineStages = [
      { icon: 'üî®', label: 'Build', status: 'success', detail: 'Completed 2m ago' },
      { icon: 'üß™', label: 'Test', status: 'success', detail: '142 tests passed' },
      { icon: 'üé≠', label: 'Stage', status: 'running', detail: 'Deploying...' },
      { icon: 'üöÄ', label: 'Deploy', status: 'pending', detail: 'Waiting' },
    ];

    let deployments = [
      { id: 1, service: 'weird-api', env: 'Production', status: 'success', branch: 'v2.4.1', timestamp: '2026-02-14T18:30:00', notes: 'Hotfix for quantum entanglement bug' },
      { id: 2, service: 'dashboard-ui', env: 'Staging', status: 'in-progress', branch: 'feature/dark-matter', timestamp: '2026-02-14T19:00:00', notes: 'New dashboard widgets' },
      { id: 3, service: 'auth-service', env: 'Production', status: 'failed', branch: 'main', timestamp: '2026-02-13T14:20:00', notes: 'Token rotation ‚Äî rolled back' },
      { id: 4, service: 'metrics-collector', env: 'Development', status: 'success', branch: 'main', timestamp: '2026-02-13T09:15:00', notes: 'Added weird metrics endpoint' },
      { id: 5, service: 'weird-api', env: 'Production', status: 'rollback', branch: 'v2.3.0', timestamp: '2026-02-12T16:45:00', notes: 'Rollback due to timeline paradox' },
    ];

    let sops = [
      { id: 1, title: 'üî• Incident Response Procedure', steps: ['Acknowledge alert in #incidents channel','Assess severity (P1-P4)','Assign incident commander','Begin investigation & document timeline','Communicate status every 15 minutes','Implement fix or rollback','Write post-mortem within 48 hours'], open: false },
      { id: 2, title: 'üóÑÔ∏è Database Failover', steps: ['Verify primary DB is unresponsive','Check replication lag on secondary','Promote secondary to primary','Update connection strings in config','Verify application connectivity','Monitor for 30 minutes','Schedule primary recovery'], open: false },
      { id: 3, title: 'üîë Secret Rotation', steps: ['Generate new credentials','Update secrets in vault','Deploy services with new credentials','Verify services are healthy','Revoke old credentials','Update documentation','Notify team in #security'], open: false },
    ];
    let nextDeployId = 6, nextSopId = 4;

    function renderPipeline() {
      document.getElementById('pipeline').innerHTML = pipelineStages.map((s, i) =>
        (i > 0 ? '<span class="pipeline-arrow">‚Üí</span>' : '') +
        `<div class="pipeline-stage ${s.status}"><div class="stage-icon">${s.icon}</div><div class="stage-label">${s.label}</div><div class="stage-status">${s.detail}</div></div>`
      ).join('');
    }

    function renderDeployments() {
      const statusIcons = { success: '‚úÖ', failed: '‚ùå', 'in-progress': 'üîÑ', rollback: '‚è™' };
      document.getElementById('deployList').innerHTML = deployments.map(d => `
        <div class="glass-card deploy-item">
          <span class="status-icon">${statusIcons[d.status] || '‚ùì'}</span>
          <div>
            <div style="font-weight:600;font-size:.9rem">${esc(d.service)} <span style="color:var(--muted);font-weight:400;font-size:.8rem">@ ${esc(d.branch)}</span></div>
            <div style="font-size:.78rem;color:var(--muted);margin-top:.15rem">${esc(d.notes)}</div>
          </div>
          <span class="env-badge">${esc(d.env)}</span>
          <span class="badge badge-${d.status.replace(/\s/g,'-')}">${d.status}</span>
          <span style="font-size:.75rem;color:var(--muted)">${fmtDate(d.timestamp)}</span>
        </div>
      `).join('');
    }

    function renderSops() {
      document.getElementById('sopList').innerHTML = sops.map(s => `
        <div class="sop-item">
          <div class="sop-header ${s.open?'open':''}" onclick="toggleSop(${s.id})">
            <span>${esc(s.title)}</span>
            <span>${s.open ? '‚ñ≤' : '‚ñº'}</span>
          </div>
          <div class="sop-body ${s.open?'open':''}">
            <div class="sop-body-inner">
              <ul class="checklist">${s.steps.map((step,i)=>`<li><input type="checkbox" id="sop${s.id}_${i}" /><label for="sop${s.id}_${i}">${esc(step)}</label></li>`).join('')}</ul>
            </div>
          </div>
        </div>
      `).join('');
    }

    function toggleSop(id) { const s = sops.find(x=>x.id===id); if(s) { s.open = !s.open; renderSops(); } }

    function openDeployModal() { document.getElementById('deployModal').classList.add('open'); }
    function closeDeployModal() { document.getElementById('deployModal').classList.remove('open'); }
    function openSopModal() { document.getElementById('sopModal').classList.add('open'); }
    function closeSopModal() { document.getElementById('sopModal').classList.remove('open'); }

    function createDeployment() {
      const service = document.getElementById('deployService').value;
      if (!service) return alert('Service name required!');
      // TODO: Connect to deployment API
      deployments.unshift({ id: nextDeployId++, service, env: document.getElementById('deployEnv').value, status: 'in-progress', branch: document.getElementById('deployBranch').value || 'main', timestamp: new Date().toISOString(), notes: document.getElementById('deployNotes').value });
      closeDeployModal();
      renderDeployments();
    }

    function createSop() {
      const title = document.getElementById('sopTitle').value;
      const stepsRaw = document.getElementById('sopSteps').value;
      if (!title) return alert('Title required!');
      // TODO: Connect to SOP API
      sops.push({ id: nextSopId++, title, steps: stepsRaw.split('\n').filter(Boolean), open: false });
      closeSopModal();
      renderSops();
    }

    function esc(s) { if(!s) return ''; const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
    function fmtDate(d) { if(!d) return '‚Äî'; return new Date(d).toLocaleString('en-US', { month:'short', day:'numeric', hour:'numeric', minute:'2-digit' }); }

    AppLoader.show();
    renderPipeline();
    renderDeployments();
    renderSops();
    setTimeout(() => AppLoader.hide(), 300);
  </script>
</body>
</html>